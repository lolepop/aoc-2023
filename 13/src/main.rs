use std::collections::HashMap;

const INPUT: &str = ".#.####
##..#.#
##..#.#
.#.####
..#..#.
####.#.
#.#.#.#
.#..#.#
##.##..
#.#..#.
#.#....

.##.....#....#.
.##.....#....#.
..#.#..##....##
...###...#..#..
#..##.....##...
.#.#...#.####.#
#.#.....######.
##..###...##...
#..#..##..##..#
.##.#.#........
#..#..##..##..#
#####.#.##.###.
.#....##.#..#.#
..##.#...#..#..
#..####..#..#..

.##......##
.##......##
.#.#.##.#.#
#.########.
#.##....##.
#.######.#.
####....###
##.#.##.#.#
###......##
...######..
####.##.###

....#.###
#.#..####
##.......
##.......
#.#..####
....#.###
#..##.#.#
#.##...#.
#.##..#.#
####..#..
#.#.###.#
#.#..##.#
####..#..
#.##..#.#
#.##...#.

##.####.#
.###.####
###...###
###...###
.###.####
#..####.#
..###..#.
##..#..#.
####...#.
#....#.#.
...#.....
#....#.##
#.#.#.##.
#.#.#.##.
#....#.##
...#.....
#....#.#.

.##..#..#..#..#
#....##.##.##.#
......#..######
......#..######
#....##.##.##.#
.##..#..#..#..#
######..#.#.###
.#..#.....#.#..
#...#..#.#.##.#
.###....#..###.
.###....#..###.
#...#..#.#.##.#
.#..#.....#.#..
######..#.#.###
.#...#..#..#..#

.######.#.#..#.
#..##....##..##
#.#.#.###.#..#.
#.#.#.###.#..#.
#..##....##..##
.######...#..#.
#.#.#..#..####.
#.#...#########
.....###.##..##
.#.#....###..##
.#...#...#....#

#.##.#......#.#
#.##.#......#.#
..##.#.......#.
.##.##.##.##...
#.#.##...#.####
##...#.##.#.##.
.#..#.##.#.#..#
.#..#.##.#.#..#
##...#.##.#.##.
#...##...#.####
.##.##.##.##...
..##.#.......#.
#.##.#......#.#

..#..#..#..#.
##.#.####.#.#
####......###
#####.##.####
..#.#.##.#.#.
####..##..###
...#......#..
##.###..###..
...#..##..#..
##.##.##.##.#
##.###..###.#
####......###
..#.##..##.#.
##..........#
##.##....##.#

.#.#....#.#......
...##..##.......#
#..######..#.##..
.###....###.##...
.#.#.##.#.#..#...
..###..###.......
###..##..####.###
#..##..##..##.#..
....#.##....#...#
###.#..#.###.#.#.
#.#......#.##..#.
#.#......#.##..#.
###.#..#.###.#.#.

#.##..##...##..
##.#.#.####..##
##..#..#.#.##.#
##.###.##......
####...####..##
##.#.#.####..##
##.#.#.####..##
####...####..##
##.###.##......
##..#..#.#.##.#
##.#.#.####..##
#.##..##...##..
#...#.#########
.##.###.#.#..#.
......####.####

##..##.
.##....
.##....
##..##.
#.###.#
#.##..#
.######
.######
#.##..#
#.###.#
.#..##.

....#..
##.#.##
..#.#..
....###
##.#.##
##.####
###....
##.##..
....#..
.....##
#####..
##.....
....#.#
####.##
##..#..

.#.##.#.....#.#.#
###..###.#####...
###..###.#####...
.#.##.#.....#.#.#
.#....#..#.###...
#.#..#.#####..##.
#.####.##......#.
##.##.##.##.##..#
###...##.##....##
#.####.#####.####
##.##.##.##......
#########.#.####.
###..####..###...

#..####..#..#..##
###.##.####.#.##.
..######.....#.##
###.##.#####...#.
#.#....#.#.#....#
##.####.###.#.#..
###....###.#.#.##
###.##.####.#####
...#..#....##...#
...#..#....##...#
###.##.####.#####
###....###.#.#.##
##.####.###.###..
#.#....#.#.#....#
###.##.#####...#.

####..##.
####...##
.....###.
...######
######...
....#....
####..#.#
####..#.#
....#....
######...
...####.#
.....###.
####...##

#...#..#.
#...#..#.
####....#
#..######
...######
###......
...##..##
###.####.
#.#....#.

.####..
##.#.#.
##.#.#.
.####..
#..#..#
.....##
.#.#..#
..#.#.#
..#.#.#
.#.#..#
.....##
#..#..#
.#.##..

#.#.#....##..
.####.#.####.
.####.#..###.
#.#.#....##..
..#...###....
..#...###....
#.#.#....##..
.####.#..###.
.####.#.####.
#.#.#....##..
##.#.####...#
..#..#..#.##.
##.#######..#
.##..####...#
###..##....##
.######.##...
.#..#.##..##.

......#
##...#.
.#....#
.#....#
.#...#.
......#
#..###.
...#..#
#.#..##
#.#...#
#..##.#
#..##.#
#.#...#
#.#..##
...#..#
#..###.
......#

##..#.#....
####..#.##.
#.#.#..####
..#....#..#
..#....#..#
#.#.#..####
####..#.##.
##..#.#....
####...###.
#....######
#...###...#
..#####..#.
..##.###.#.
..##.###.#.
..###.#..#.

..........#.###
..######...##.#
.#......#......
#.##..##.#.....
##.####.##.#.##
#...##...###..#
#...##...###..#
##.####.##.#.##
#.##..##.#..#..

..#.......##.#.
#.#.#...####..#
.#..##.#.#.#.##
.#..##.#.#.#.##
#.#.#...####..#
..#.......##.#.
..#..#####....#
.#.#.#......###
.#.###......###

...#.##.#
....#..#.
#..##..##
...######
.#.#....#
.#.#....#
...######
#..##..##
....#..#.
#..#.##.#
###..##..

.#.####.#....
#.#....#.#...
###....##.###
#.##..##.#.##
.#.#..#.#.###
#.######.#...
#.##..##.####

##.#.##
#......
#...#.#
####.##
.#.#..#
...####
...####
.#.#..#
####.##
#...#.#
#......
##.#.##
.#..#..
#..#..#
#.....#

#.########.#.
..##....##..#
..##....##..#
#.########.#.
.##..##..##.#
#.##....##.#.
.#.....#..#.#
...#.##.#....
#..........#.
.#...##...#..
.##.#..#.##..

.##..#..#.##.#.
#..#.##...##...
#######..####..
#######..####..
#..#.##...##...
.##..#..#.##.#.
.#.....#.#....#
......###.#..##
.......#.###.#.
####.##..#..#.#
....#.#.##.#..#
######.######..
....#..##.###..

##.#....#..
##.#...##..
.###.##.#.#
##.####....
...##....#.
..#....#.#.
.....##..##
.#..####...
.#..####...
.....##..##
..#....#.#.
...##....#.
##.####....
.###.##.#.#
##.#...##..

##.####.#
.#.####.#
.#.####.#
##..##..#
####..###
##.####.#
#.#....#.

...#..##.
......##.
#...#####
#..#.####
...######
.#.######
##...#..#
###..####
##..#....

###..###.
####.#.#.
..#..##.#
###.#...#
......##.
..###.###
..#...###
##..#.#.#
##.......
..#......
######...
#####...#
##..##.##
###....#.
###.#.###
#####..##
#####.###

..#..###...
..#...##...
##..###.##.
#.#..###..#
.####...##.
#.###.#.###
..##.....##
#.#..##.#.#
######.#.#.
.####..#..#
.##.##.....
..#......##
..#......##

..#...##...#..#
..####..####...
.#.#.#..#.#.#..
###.#.##.#.###.
..##.####.##...
#..###..###..#.
#....####....#.
..#.######.#...
..#.######.#...
#....####....#.
#..###..###..#.
..##.####.##...
###.#.##.#.###.
.#.#.#..#.#.#..
..####..####..#
..#...##...#..#
##.##.##.##.##.

.###..#.#
..#...#.#
##.####..
#..#.####
....##...
....##...
#..#.####
#..####..
..#...#.#
.###..#.#
.###..#.#

#..##..##...##...
........#########
##....###########
#.#..#.#.#.#..#.#
.##..##..##....##
###..############
#########...##...
.#.##.#.#########
..#..#..###....##
###..#####.#..#.#
.#.##.#..######.#
..#..#..#..#..#..
..####..##..##..#
#.####.##########
##.##.##.#.####.#
..####..#..#..#..
########...####..

..#.#....#.#..##.
###.###.##.###..#
##.#......#.##..#
#....####....#..#
.##.#....#.##.##.
.#....##....#.##.
....######.......
#....#..#....#..#
##.#.#..#.#.#####
#.#...##...#.####
#.##.####.##.#..#
#####.##.########
.##..#..#..##.##.
.###......###....
#..#.#..#.#..#..#

#.#.#.#.#.####.
...########..##
..#.###.###..##
..#.#.#.###..##
#...#..#...##..
.##..##########
#..#.....##..##

#.###..##.#......
#.###..##.#......
.#.#...#....#..#.
#.#####..###.....
#####......#.###.
....#.###.#...###
....##.#.#.##..#.
#.##.#...#...##.#
..##..#.#########
#.#..###.#..###.#
#.#..###.#..#####
..##..#.#########
#.##.#...#...##.#
....##.#.#.##..#.
....#.###.#...###
#####......#.###.
#.#####..###.....

......#
....#.#
#..#.#.
.#.####
.#.####
#..#.#.
....#.#
......#
.####.#

....#.##.##..##..
####..#.##.#.##.#
.#.....#.###....#
###.####.........
#.##.#.#..###..##
##.#.####.#######
####.##.#....##..
#######.#....##..
##.#.####.#######
#.##.#.#..###..##
###.####.........

###..#...##...#..
..#.####.##.####.
##.#..#......#..#
..#..#........#..
###.#.########.#.
##.#...######...#
###.############.
##.#.#..####..#.#
##..#.#.####.#.#.
..#...#..##..#...
###.#####..#####.
#.#.###.####.###.
##..###.####.###.

##.##.####..##.##
###..####..#..#..
#.####.##..##.#..
..####..#..#...#.
##.##.##....#...#
#.#..#.####.#.#..
............#...#
#..##..#...#..##.
#......#.##...##.
.#.##.#.###.##..#
##.##.####.####.#
##.##.####.####.#
.#.##.#.###.##..#
#......#.##...##.
#..##..#...##.##.
............#...#
#.#..#.####.#.#..

.##..###.####..#.
.###...####.###..
##...#..##.#.###.
##.##.#.##.##.#.#
##.##...##.##.#.#
#.##...#..##.##..
.###....#####.#..
..####.#..#..###.
..####.#..#..###.
.###....#####.#..
#.##...#..##.##..
##.##...##.##.#.#
##.##.#.##.##.#.#

##.##..###.
##.##.#..#.
......#...#
......#...#
##.##.#..#.
##.##..###.
###....#.#.
#.#..#..#..
#.##...#.#.
..####.###.
..####.##..
#.##...#.#.
#.#..#..#..
###....#.#.
##.##..###.
##.##.#..#.
......#...#

###.############.
...#.#.######.#.#
##.......##......
##.....#....#....
####....####....#
..##.##.#..#.##.#
...######..######
####.##..##..##.#
#...##..#..#..##.
..#.#.#..##..#.#.
.....#.#....#.#..
#####..#.##.#..##
...#..##....##..#
####...#.##.#...#
###.#..#....#..#.

....##..#.#..
....#...#####
....#...#.###
.##..#...#...
....###.####.
#..##.#.##...
####..#####..
#####..#.##..
####...##....
#####.#...###
#..###.####..
.##.####..###
####.###..###
....#...#....
.##...#######

...######
#.#..##..
.#.######
#...#####
..#######
#####..##
#.#.####.
.#...##..
.#..#..#.
#...#..#.
.###.##.#
..##.##.#
..##.##.#
.###.##.#
#...#..#.

##...#.
##...#.
.######
###...#
.#.#.#.
...#.#.
#..#.##
#..#.##
...#.#.
.#.#.#.
##....#
.######
##...#.

##..#..##
##.#.....
##...##..
#.###....
###..#.##
#####.###
##.####..
#####.###
....#.###
..##...##
..####...
..###....
...######
#######..
###..#...

####....#####
#####...#.##.
......#.##..#
....####.####
....##...#..#
#..#.#....#..
.....#...#..#
########.....
#######.#.##.
#..##..#.#..#
#..##.....##.
.....##.#.##.
.##.#.#.#.##.
########.####
#..#...#..##.

.#####.#.##
.#####.#.##
...#......#
.#.#..###.#
###.###.#.#
###..#...##
##.#####...
##..##..#.#
..##.####.#
#.#.#..####
#.#.#..####
..##.####.#
##..##..#.#
##.#####...
###..#...##
##..###.#.#
.#.#..###.#

##......#####
#..#..#..##.#
#.#.##.#.####
##..##..##..#
..#....#...##
###########..
..######..##.
#.....#..#..#
.##....##..##
###.##.###...
#........#..#
##..##..###..
##..##..###..

#.#..#.#..#.#..
#.##.#.#..#.#.#
#.##.#.#..#.#.#
#.#..#.#..#.#..
...#...#..#...#
...##..#..#..##
..#...#....#...
.##.#.######.#.
.....#......#..
#######....####
#.#.###.##.###.
##...#......#..
#.##.#.####.#.#
#.###..#..#..##
###..##....##..
#.###..#..##.##
#.#.....##.....

...#.#..#.#......
##..#....#..####.
#####....########
##.#......#.####.
#.#...##...#.##.#
##..........####.
#.##########.##.#
.#####..#.###..##
.############..##

..#.##..#
..#.##..#
.###..#..
##.#..##.
#...#.#..
###.#..#.
##.#.####
..#...#..
##.#....#
..###.#..
#.#.###.#
.#.#####.
...#....#
...#....#
.#.#####.
#.#.###.#
..###.#.#

..#...#.#
.#....#.#
#..#####.
..#####..
...##...#
#.##.....
#.##.....
...##...#
#.#####..
#..#####.
.#....#.#
..#...#.#
.#..#.##.
.#..#.##.
..#...#.#

.#.####.##.####
##.....#..#####
#.#.#......####
##.#.#.#..#####
.#.########.##.
#.....##....##.
.#..#....##.##.
#..#.#....##.##
##.###.####.##.
##.##....#.....
#.##.##.####..#
.##..###.#.....
.##..###.#.....

......#..#.
.......#..#
.......#..#
......#....
######.####
#.##.##....
#######.##.
######.#..#
######..#..
#########..
......####.
#.##.###...
######.#.##
##..##.#...
#######....
..##...####
.......##..

.##.#####..#.
##.#..#.#....
.#.###.##.#.#
##.###.....#.
..#..#.###..#
##..#.#....##
##..#.#....##
..#..#.###..#
##.###.....#.
.#.###.##.#.#
##.#..#.#....
.##..####..#.
.##..####..#.

#...#..##.#.#..
#.#..##.####.#.
#.#..##.####.#.
#...#..##.#.#..
.#.#...#..###.#
......#.....###
....##..#.#####
##...####.#.##.
#...#...##..###
...###.##..##.#
...##..##..##.#

###..####..
###..####..
##....#....
.####.###..
###.###.#..
##.###..###
....#.#..##
#.#..#..#..
..#...#####
.#.####....
##......##.

##.##.#.#..
###.#..##..
..##.##.##.
#.#..#.#.##
#.###....#.
#..#.#...##
...##.###.#
...##.###.#
#..#.#....#
#.###....#.
#.#..#.#.##
..##.##.##.
###.#..##..
##.##.#.#..
.###.#..##.
#.####..#.#
#.####..#.#

####....####...
...#....#...#..
..##....##.....
...##..##....##
....####....#..
#...####...#...
.#...##...#.###
.#........#....
.....##........
#..........#...
.#.#.##.#.#.###
##..#..#.###.##
.##......##..##
###.#..#.###.##
#...####...#...
..##....##..###
#.#.####.#.#...

####..#..
....####.
......##.
.##...###
.##...###
......#..
....####.
####..#..
.##.##.#.
.##..#.#.
#######.#
....###.#
######..#

#.##.#..#..
#.##.##.#..
#.##.##.#..
..##....#..
..##...#.#.
#....###.##
..##...##.#
.#..#..##.#
#.##.##...#

.#.########.#..
####.......###.
#.###.##.###.##
..#........#..#
...##....##....
###..#..#..###.
##.########.###
##.########.###
###..#..#..###.

...##.....#
.##..##....
..####..##.
#..##..#.##
#..##..#.#.
###..####..
.#..#.#.###
.##..##.#.#
##....#####
..#..#....#
##....##..#
.#.##.#.###
...##...##.
##....###..
##....###..
...##...##.
.#.##.#.###

#....######.#
#.##.#..#.#.#
.####.#...##.
#######.##...
##..#####.#..
......###...#
......###...#
##..##.##.#..
#######.##...
.####.#...##.
#.##.#..#.#.#
#....######.#
..##..###.#..

..####...##..
.##..##..##..
#.#..#.#....#
##....##....#
#.#..#.##..##
#.####.#.##.#
##.##..#.##.#
########....#
...##...####.

##.....
..#.##.
###.###
.#.####
.###..#
.###..#
.#.####

#....####.###
#....####.###
.#..#...##.##
#.##.#...####
.#..##..#....
.#..#.#...#..
.####...##...
#.##.#.#.#.#.
..##...#####.
##..##.##.##.
#....###.#..#
.#..#.#..##.#
.......#.#...
.#..#.#.####.
......#..#...
##..##..##.#.
.#..#..#.###.

#.#######.#.#..
..#.#...#...#..
#......#...#.##
##..##....###..
.#.##.###.#####
###..#.#..##...
###..#.#...#...
##.#.##.##..###
.####.##..#..#.
..#####...##.##
..#####...##.##
.####.##..#..#.
##.#.##.##..###
###..#.#...#...
###..#.#..##...

##.##.##.###.#..#
##.###.#..##..##.
.###..#.##..###.#
#.#...##.#####..#
..#.#.....#..####
#...#.#..####.##.
#.#...####.#.####
..#.#.#..##.#.##.
....##..##..#####
.#..##...#.###..#
.##.#..#..#.##..#
.##.#..#..#.##..#
.#..##...#.###..#
....##..##..#####
..#.#.#..##.#.##.

####...
#.#####
..#####
####...
#....##
.###.##
.#..#..
###.###
##...##
.###.##
#.#####

..######...
.#......#..
#....#...#.
##......###
.##....##.#
...####...#
.#.#..#.#.#
.#..##..#..
#........#.
#.#.##.#.##
.#.####.#.#
.#.#..#.#..
.#.####.#..
.#.####.#..
.#.#..#.#..

##.#......#.##.
##.#......#.##.
####......#####
###..#..#..###.
...#......#...#
#...#.##.#...#.
##....##....##.
##.###..###.##.
.###......##..#
...########....
###.#....#.###.
..###....###..#
#.#.#.##.#.#.#.

.######.######.##
.#.##.#...##...#.
##....####..####.
.##..##........##
#.#..#.#.####.#.#
##.##.###....###.
.#....#.#....#.#.
.#.##.#.#....#.#.
..#..#..######..#
########..##.####
...##............
#.####.#......#.#
..#..#..######..#

.#.##......
...##......
..#..##.#..
..#.#..###.
....#...#..
#.#..##..##
...##.#.###
..#.###..#.
..#.###..#.
...##.#.###
#.#..##..##
....#...#..
..#.#..###.

#..#.####.#..##
#..###..###..#.
#.#.#.##.#.#.##
##..#.##.#..###
.##.##..#..##..
..#..#..#..#...
##..#....#..###
.##.#....#.##.#
...#..##..#...#
....#....#....#
.....#..#......
..#.#....#.#...
..##......##...
..##......##...
..#.#....#.#...
.....#..#......
....#....#....#

.##..#.
.##..#.
#.#.###
..##...
.#...#.
#####..
#.#.###
#.#.###
#####..
.#...#.
...#...

###..#..###
.....#...##
......#.#..
..#.#...#..
...###.####
##.##...##.
..###...###
##...#.#..#
#.##.##..#.
..#...#.#..
...#.#..#..
...#.#..#..
..#...#.#..

.....##..
....#..#.
.....##..
#..#.##.#
####....#
.##......
#..###.##

.#..##.######
#.#..##.#.##.
#.#..##.#.##.
.#..##.######
.####..#.....
.#.#.#.#.#..#
####...#...#.

#..#...
...#...
.###.#.
..#.##.
..#.#.#
.##.##.
.##.##.
..#.#.#
..#.##.
.###.#.
...#...
#..#...
...###.
#....##
.######

.##...#.#
####....#
...####.#
#..#.####
.##.##.##
#####.#.#
....#####
.##.##.#.
.##..##.#
#..#.####
.##...##.
#..#..###
#..#..###

..#...#
..#...#
.######
.##.#.#
.#.#.#.
#...##.
......#
#...#.#
#...#.#
......#
#...##.
.#.#.#.
.##...#
.######
..#...#

###.##.
..##...
.#.#..#
.#.#...
..##...
###.##.
###...#
.#.....
#...#.#
...##.#
...##.#
#...#.#
.#.....
###...#
###.##.

....#..#.
##.######
##.#....#
..###..##
..#..##.#
.....##..
##.#.##.#
..##.##.#
###..##..

###..##.##.#.
###..##.##.##
######.#.#.##
####.#..#.#.#
...#.#.##.###
##..##.#.....
....##.#..##.
........#.#..
...#....#.##.
###.####.....
...##...#.###
####..#.###..
....#..#..##.
##.####...#.#
...#.......#.

..#.#..
..#####
..#####
..#.#..
##..#..
...#.##
.######
.###..#
.####.#
.######
...#.##

.####..####.#..##
##..#..#..###.#..
#...#..#...#.#.##
.#.##..##.#.##..#
#..#.##.#..#.....
.#..#..#..#......
.#.######.#..#...
##.##..##.##.#...
.###....###.#####

..###..#.##..
..###..#.#...
...#.#..#####
#####.###.#.#
...#.#..#.#.#
#####..###.#.
##.....##.#..

....##.
.#.####
.######
.#.#..#
#.##..#
...####
.######
#...##.
##..##.
#...##.
#...##.
.######
...####

##....##.
##...##..
##.####.#
..##..##.
..##..##.
##.##.#.#
##...##..
##....##.
....##.##
..#...###
...##.##.
...#...##
#####..#.

##.#.#.
#..#.#.
..#...#
##.#...
...#...
.###...
.#.###.
.#..#..
.#..#..
.#.###.
.###...
...#...
##.#...
..#...#
#..#.#.

.###....#
#..##..##
#.#######
#.#......
##...##..
..##....#
#....##..
###......
#.#.####.
....####.
#####..##
.##......
..##....#
####.##.#
.###.##.#

.##.##.##..##.##.
.##.#.########.#.
.##.####.##.####.
#..######..######
.......##..##....
..#..##########..
....#.##.##.##.#.
#..#.##.####.##.#
####..#......#..#

#..####..##..
.#..##..#..#.
.#......#..#.
..##..##....#
...#..#......
#..#..#..##..
.#......#..#.
#........##..
...####......
.###..###..##
...#..#......
#..####..##..
..#....#....#
#........##.#
.###..###..##

#.#..##..#.#.....
#.#..##..#.#.##..
...#.##.#...#..#.
.#........####.##
#.##.##.##.#...##
..#.####.#.....#.
####.##.######.##
###.#..#.###..###
..##.##.##...#..#
..##.##.##...#..#
###.#..#.###..###";

fn parse_input(input: &str) -> Vec<Vec<Vec<char>>> {
    input.split("\n\n")
        .map(|puzzle|
            puzzle.split("\n").map(|line|
                line.chars().collect()
            ).collect()
        ).collect()
}

fn hash_puzzle(puzzle: &Vec<Vec<char>>) -> (Vec<usize>, Vec<usize>, HashMap<usize, Vec<usize>>) {
    let row = puzzle.iter().map(|row| row.iter().collect::<String>()).collect::<Vec<_>>();
    let col = (0..puzzle[0].len()).map(|i|
        (0..puzzle.len()).map(|v|
            puzzle[v][i]
        ).collect::<String>()
    ).collect::<Vec<_>>();

    let mut hashes = HashMap::new();
    let mut hash = |a: Vec<String>| {
        let mut acc = Vec::new();
        for v in a {
            if let Some(hash) = hashes.get(&v) {
                acc.push(*hash);
            } else {
                let hash = hashes.len();
                hashes.insert(v, hash);
                acc.push(hash);
            }
        }
        acc
    };

    let row_hash = hash(row);
    let col_hash = hash(col);

    // lmfao
    let single_char_diff = hashes.iter().map(|(k1, v1)|
        (*v1, hashes.iter().filter_map(move |(k2, v2)|
            (v1 != v2).then(||
                k1.chars().zip(k2.chars()).map(|(a, b)| (a != b) as usize ).sum::<usize>()
            ).and_then(|a| (a == 1).then(|| *v2))
        ).collect::<Vec<_>>())
    ).collect::<HashMap<_, _>>();

    (row_hash, col_hash, single_char_diff)

}

fn calc_symmetry_a(arr: &Vec<usize>) -> Option<usize>  {
    // oops too smart of a solution
    let matching_pairs = arr.iter().zip(arr.iter().skip(1))
        .enumerate()
        .filter_map(|(i, (a, b))| (a == b).then(|| i));
    let symmetries = matching_pairs.filter(|left| {
        arr[0..=*left].iter().rev().zip(arr[left+1..].iter())
            .all(|(l, r)| *l == *r)
    });
    symmetries.max().map(|x| x + 1)
}

fn calc_symmetry_b(arr: &Vec<usize>, pmap: &HashMap<usize, Vec<usize>>) -> Option<usize>  {
    for left_start in 0..arr.len() {
        let mut diff = 0;
        for (left, right) in arr[0..=left_start].iter().rev().zip(arr[left_start+1..].iter()) {
            if left != right {
                if pmap.get(&left).unwrap().contains(right) {
                    diff += 1;
                } else {
                    diff = 0;
                    break;
                }
            }
        }
        if diff == 1 { return Some(left_start + 1) }
    }
    None
}

fn solve_puzzle_a(puzzle: &Vec<Vec<char>>) -> Option<usize> {
    let (row_hash, col_hash, _) = hash_puzzle(puzzle);
    calc_symmetry_a(&col_hash).or_else(||
        calc_symmetry_a(&row_hash).map(|s| s * 100)
    )
}

fn solve_puzzle_b(puzzle: &Vec<Vec<char>>) -> Option<usize> {
    let (row_hash, col_hash, pmap) = hash_puzzle(puzzle);
    // println!("{puzzle:?}");

    let a = calc_symmetry_b(&col_hash, &pmap);
    let b = calc_symmetry_b(&row_hash, &pmap);
    // println!("{a:?}");
    // println!("{b:?}");

    a.or_else(||
        b.map(|s| s * 100)
    )
}

fn main() {
    let puzzles = parse_input(INPUT);
    // let a = solve_puzzle(&puzzles[0]);
    // println!("{a:?}")
    let solution_a = puzzles.iter().map(|puzzle| solve_puzzle_a(puzzle).unwrap()).sum::<usize>();
    let solution_b = puzzles.iter().map(|puzzle| solve_puzzle_b(puzzle).unwrap()).sum::<usize>();
    println!("{solution_a}");
    println!("{solution_b}");
}
